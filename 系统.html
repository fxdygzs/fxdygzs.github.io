<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>记名管理系统</title>
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- 配置Tailwind自定义颜色和字体 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        accent: '#8B5CF6',
                        dark: '#1E293B',
                        light: '#F8FAFC'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <!-- 自定义工具类 -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .transition-custom {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .card-hover {
                @apply hover:shadow-lg hover:-translate-y-1 transition-all duration-300;
            }
        }
    </style>
    
    <style>
        /* 基础动画 */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* 平滑滚动 */
        html {
            scroll-behavior: smooth;
        }
        
        /* 背景渐变动画 */
        .bg-gradient-animated {
            background-size: 200% 200%;
            animation: gradientAnimation 15s ease infinite;
        }
        
        @keyframes gradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* 返回按钮动画 */
        .back-button {
            transition: all 0.2s ease;
        }
        
        .back-button:hover {
            transform: translateX(-3px);
        }
    </style>
</head>

<body class="bg-light text-dark min-h-screen font-sans">
    <!-- 导航栏 -->
    <nav id="navbar" class="fixed w-full z-50 transition-all duration-300 bg-white/90 backdrop-blur-sm shadow-sm">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-book text-primary text-2xl"></i>
                <span class="text-xl font-bold text-primary">记名管理系统</span>
            </div>
            
            <div class="hidden md:flex space-x-6">
                <button onclick="showSection('welcome')" class="nav-link font-medium hover:text-primary transition-colors">欢迎</button>
                <button onclick="showSection('login')" class="nav-link font-medium hover:text-primary transition-colors">登录</button>
                <button onclick="showSection('query')" class="nav-link font-medium hover:text-primary transition-colors">查询</button>
            </div>
            
            <button class="md:hidden text-dark text-xl" id="mobile-menu-button">
                <i class="fa fa-bars"></i>
            </button>
        </div>
        
        <!-- 移动端菜单 -->
        <div id="mobile-menu" class="hidden md:hidden bg-white shadow-md absolute w-full">
            <div class="container mx-auto px-4 py-2 flex flex-col space-y-3">
                <button onclick="showSection('welcome'); toggleMobileMenu()" class="py-2 hover:text-primary transition-colors">欢迎</button>
                <button onclick="showSection('login'); toggleMobileMenu()" class="py-2 hover:text-primary transition-colors">登录</button>
                <button onclick="showSection('query'); toggleMobileMenu()" class="py-2 hover:text-primary transition-colors">查询</button>
            </div>
        </div>
    </nav>

    <!-- 主内容区域 -->
    <main class="pt-16">
        <!-- 欢迎区块 -->
        <section id="welcome" class="section active min-h-[calc(100vh-4rem)] bg-gradient-animated bg-gradient-to-br from-blue-50 to-purple-50 flex items-center">
            <div class="container mx-auto px-4 py-16">
                <!-- 返回按钮 (在欢迎页面默认隐藏) -->
                <button id="back-to-welcome" class="back-button absolute top-24 left-4 md:top-28 md:left-8 text-gray-500 hover:text-primary hidden">
                    <i class="fa fa-arrow-left mr-1"></i> 返回
                </button>
                
                <div class="max-w-4xl mx-auto text-center">
                    <div class="inline-block p-4 rounded-full bg-primary/10 mb-6">
                        <i class="fa fa-clipboard-check text-4xl text-primary"></i>
                    </div>
                    
                    <h1 class="text-[clamp(2rem,5vw,3.5rem)] font-bold mb-6 text-dark leading-tight text-shadow">
                        记名管理系统
                    </h1>
                    
                    <p class="text-lg md:text-xl text-gray-600 mb-10 max-w-2xl mx-auto">
                        本系统用于记录和查询被记名人的相关信息，包括姓名、记录次数、原因及图片等。管理员可以登录系统添加记录，任何人都可以查询公开的记名信息。
                    </p>
                    
                    <div class="flex flex-col sm:flex-row justify-center gap-4">
                        <button onclick="showSection('login')" class="px-8 py-3 bg-primary text-white rounded-lg font-medium shadow-md hover:bg-primary/90 transform hover:-translate-y-0.5 transition-all duration-300">
                            <i class="fa fa-sign-in mr-2"></i>管理员登录
                        </button>
                        <button onclick="showSection('query')" class="px-8 py-3 bg-white text-primary border border-primary rounded-lg font-medium shadow-sm hover:bg-primary/5 transform hover:-translate-y-0.5 transition-all duration-300">
                            <i class="fa fa-search mr-2"></i>查询记录
                        </button>
                    </div>
                    
                    <div class="mt-16 grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="bg-white p-6 rounded-xl shadow-sm card-hover">
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mb-4">
                                <i class="fa fa-user-plus text-primary text-xl"></i>
                            </div>
                            <h3 class="text-xl font-semibold mb-2">记录管理</h3>
                            <p class="text-gray-600">管理员可以添加、编辑和管理被记名人的相关信息和记录。</p>
                        </div>
                        
                        <div class="bg-white p-6 rounded-xl shadow-sm card-hover">
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mb-4">
                                <i class="fa fa-search text-secondary text-xl"></i>
                            </div>
                            <h3 class="text-xl font-semibold mb-2">快速查询</h3>
                            <p class="text-gray-600">便捷的查询功能，可快速获取被记名人的累积次数、原因等信息。</p>
                        </div>
                        
                        <div class="bg-white p-6 rounded-xl shadow-sm card-hover">
                            <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mb-4">
                                <i class="fa fa-shield text-accent text-xl"></i>
                            </div>
                            <h3 class="text-xl font-semibold mb-2">权限管理</h3>
                            <p class="text-gray-600">严格的权限控制，只有管理员可以登录系统进行记录操作。</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 登录区块 -->
        <section id="login" class="section hidden min-h-[calc(100vh-4rem)] bg-gray-50 py-16">
            <div class="container mx-auto px-4">
                <!-- 返回按钮 -->
                <button id="back-to-login" class="back-button absolute top-24 left-4 md:top-28 md:left-8 text-gray-500 hover:text-primary">
                    <i class="fa fa-arrow-left mr-1"></i> 返回
                </button>
                
                <div class="max-w-3xl mx-auto">
                    <div class="text-center mb-10">
                        <h2 class="text-3xl font-bold mb-3">管理员登录</h2>
                        <p class="text-gray-600">请输入管理员密码以登录系统</p>
                    </div>
                    
                    <div class="bg-white rounded-2xl shadow-md p-8 max-w-md mx-auto">
                        <!-- 登录表单 -->
                        <div id="login-form">
                            <div class="mb-6">
                                <label for="password" class="block text-sm font-medium text-gray-700 mb-1">管理员密码</label>
                                <div class="relative">
                                    <input type="password" id="password" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary transition-colors" placeholder="请输入密码">
                                    <button type="button" id="toggle-password" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700">
                                        <i class="fa fa-eye-slash"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <button id="login-button" class="w-full bg-primary text-white py-3 px-4 rounded-lg font-medium hover:bg-primary/90 transition-colors mb-4">
                                登录
                            </button>
                            
                            <p id="login-error" class="text-red-500 text-sm text-center hidden">密码错误，请重试</p>
                        </div>
                        
                        <!-- 记名表单 (初始隐藏) -->
                        <div id="recording-form" class="hidden fade-in">
                            <div class="mb-4">
                                <h3 class="text-xl font-semibold mb-6 text-center">添加记名记录</h3>
                                
                                <div class="mb-5">
                                    <label for="person-name" class="block text-sm font-medium text-gray-700 mb-1">被记名人姓名</label>
                                    <input type="text" id="person-name" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary transition-colors" placeholder="请输入姓名">
                                </div>
                                
                                <div class="mb-5">
                                    <label for="record-reason" class="block text-sm font-medium text-gray-700 mb-1">记录原因</label>
                                    <textarea id="record-reason" rows="3" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary transition-colors" placeholder="请输入记录原因"></textarea>
                                </div>
                                
                                <div class="mb-5">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">上传图片 (可选)</label>
                                    <div class="flex items-center justify-center w-full">
                                        <label for="image-upload" class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors">
                                            <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                                <i class="fa fa-cloud-upload text-gray-400 mb-2"></i>
                                                <p class="mb-1 text-sm text-gray-500"><span class="font-semibold">点击上传</span> 或拖放文件</p>
                                                <p class="text-xs text-gray-500">支持 PNG, JPG 格式</p>
                                            </div>
                                            <input id="image-upload" type="file" accept="image/*" class="hidden" />
                                        </label>
                                    </div>
                                    <div id="image-preview-container" class="mt-3 hidden">
                                        <img id="image-preview" src="" alt="预览图" class="max-h-40 mx-auto rounded-md">
                                    </div>
                                </div>
                                
                                <div class="flex gap-3">
                                    <button id="save-record" class="flex-1 bg-secondary text-white py-2 px-4 rounded-lg font-medium hover:bg-secondary/90 transition-colors">
                                        保存记录
                                    </button>
                                    <button id="logout-button" class="flex-1 bg-gray-200 text-gray-700 py-2 px-4 rounded-lg font-medium hover:bg-gray-300 transition-colors">
                                        退出登录
                                    </button>
                                </div>
                                
                                <p id="record-success" class="text-green-500 text-sm text-center mt-4 hidden">记录保存成功！</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 查询区块 -->
        <section id="query" class="section hidden min-h-[calc(100vh-4rem)] bg-gray-50 py-16">
            <div class="container mx-auto px-4">
                <!-- 返回按钮 -->
                <button id="back-to-query" class="back-button absolute top-24 left-4 md:top-28 md:left-8 text-gray-500 hover:text-primary">
                    <i class="fa fa-arrow-left mr-1"></i> 返回
                </button>
                
                <div class="max-w-4xl mx-auto">
                    <div class="text-center mb-10">
                        <h2 class="text-3xl font-bold mb-3">查询记名记录</h2>
                        <p class="text-gray-600">输入被记名人姓名查询相关记录信息</p>
                    </div>
                    
                    <div class="bg-white rounded-2xl shadow-md p-6 md:p-8 mb-8">
                        <div class="flex flex-col md:flex-row gap-3">
                            <input type="text" id="search-name" class="flex-1 px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary transition-colors" placeholder="请输入被记名人姓名">
                            <button id="search-button" class="px-6 py-3 bg-primary text-white rounded-lg font-medium hover:bg-primary/90 transition-colors whitespace-nowrap">
                                <i class="fa fa-search mr-2"></i>查询
                            </button>
                        </div>
                        
                        <div id="search-results" class="mt-8 hidden">
                            <div id="no-results" class="text-center py-10 hidden">
                                <i class="fa fa-search text-gray-300 text-5xl mb-4"></i>
                                <p class="text-gray-500">未找到相关记录</p>
                            </div>
                            
                            <div id="results-container" class="space-y-6">
                                <!-- 结果将通过JavaScript动态填充 -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-2xl shadow-md p-6 md:p-8">
                        <h3 class="text-xl font-semibold mb-4">最近记录</h3>
                        <div id="recent-records" class="space-y-4">
                            <!-- 最近记录将通过JavaScript动态填充 -->
                            <p class="text-gray-500 text-center py-6">暂无记录</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- 页脚 -->
    <footer class="bg-dark text-white py-8">
        <div class="container mx-auto px-4">
            <div class="text-center">
                <div class="flex items-center justify-center space-x-2 mb-4">
                    <i class="fa fa-book text-primary"></i>
                    <span class="text-lg font-bold">记名管理系统</span>
                </div>
                <p class="text-gray-400 text-sm">© 2023 记名管理系统 - 保留所有权利</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // 存储记录数据的数组
        let records = JSON.parse(localStorage.getItem('nameRecords')) || [];
        let isLoggedIn = false;
        // 记录访问历史，用于返回功能
        let sectionHistory = ['welcome'];
        
        // DOM元素
        const sections = document.querySelectorAll('.section');
        const navLinks = document.querySelectorAll('.nav-link');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const navbar = document.getElementById('navbar');
        
        // 返回按钮
        const backToWelcome = document.getElementById('back-to-welcome');
        const backToLogin = document.getElementById('back-to-login');
        const backToQuery = document.getElementById('back-to-query');
        
        // 登录相关元素
        const loginForm = document.getElementById('login-form');
        const recordingForm = document.getElementById('recording-form');
        const passwordInput = document.getElementById('password');
        const togglePasswordButton = document.getElementById('toggle-password');
        const loginButton = document.getElementById('login-button');
        const loginError = document.getElementById('login-error');
        const logoutButton = document.getElementById('logout-button');
        
        // 记录相关元素
        const personNameInput = document.getElementById('person-name');
        const recordReasonInput = document.getElementById('record-reason');
        const imageUploadInput = document.getElementById('image-upload');
        const imagePreviewContainer = document.getElementById('image-preview-container');
        const imagePreview = document.getElementById('image-preview');
        const saveRecordButton = document.getElementById('save-record');
        const recordSuccess = document.getElementById('record-success');
        
        // 查询相关元素
        const searchNameInput = document.getElementById('search-name');
        const searchButton = document.getElementById('search-button');
        const searchResults = document.getElementById('search-results');
        const noResults = document.getElementById('no-results');
        const resultsContainer = document.getElementById('results-container');
        const recentRecordsContainer = document.getElementById('recent-records');
        
        // 显示指定区块
        function showSection(sectionId) {
            // 记录访问历史（避免重复记录同一区块）
            if (sectionHistory[sectionHistory.length - 1] !== sectionId) {
                sectionHistory.push(sectionId);
            }
            
            // 更新返回按钮显示状态
            updateBackButtons();
            
            // 隐藏所有区块
            sections.forEach(section => {
                section.classList.add('hidden');
                section.classList.remove('active');
            });
            
            // 显示选中的区块
            const activeSection = document.getElementById(sectionId);
            activeSection.classList.remove('hidden');
            activeSection.classList.add('active', 'fade-in');
            
            // 更新导航栏链接状态
            navLinks.forEach(link => {
                link.classList.remove('text-primary', 'font-semibold');
                if (link.textContent.toLowerCase() === sectionId.toLowerCase()) {
                    link.classList.add('text-primary', 'font-semibold');
                }
            });
            
            // 滚动到页面顶部
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // 更新返回按钮显示状态
        function updateBackButtons() {
            // 在欢迎页面隐藏返回按钮，其他页面显示
            const isWelcomePage = sectionHistory[sectionHistory.length - 1] === 'welcome';
            backToWelcome.classList.toggle('hidden', isWelcomePage);
            backToLogin.classList.toggle('hidden', sectionHistory[sectionHistory.length - 1] !== 'login');
            backToQuery.classList.toggle('hidden', sectionHistory[sectionHistory.length - 1] !== 'query');
        }
        
        // 返回上一页
        function goBack() {
            if (sectionHistory.length > 1) {
                // 移除当前页面
                sectionHistory.pop();
                // 显示上一个页面
                const previousSection = sectionHistory[sectionHistory.length - 1];
                showSection(previousSection);
            }
        }
        
        // 为返回按钮添加点击事件
        backToWelcome.addEventListener('click', goBack);
        backToLogin.addEventListener('click', goBack);
        backToQuery.addEventListener('click', goBack);
        
        // 切换移动端菜单
        function toggleMobileMenu() {
            mobileMenu.classList.toggle('hidden');
        }
        
        // 监听滚动事件，改变导航栏样式
        window.addEventListener('scroll', () => {
            if (window.scrollY > 50) {
                navbar.classList.add('shadow-md');
                navbar.classList.remove('shadow-sm');
            } else {
                navbar.classList.remove('shadow-md');
                navbar.classList.add('shadow-sm');
            }
        });
        
        // 切换密码可见性
        togglePasswordButton.addEventListener('click', () => {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            
            // 切换图标
            const icon = togglePasswordButton.querySelector('i');
            if (type === 'password') {
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        });
        
        // 登录功能
        loginButton.addEventListener('click', () => {
            const password = passwordInput.value.trim();
            // 管理员密码：cmd263666
            if (password === 'cmd263666') {
                isLoggedIn = true;
                loginForm.classList.add('hidden');
                recordingForm.classList.remove('hidden');
                loginError.classList.add('hidden');
                passwordInput.value = '';
            } else {
                loginError.classList.remove('hidden');
                // 添加抖动动画
                loginForm.classList.add('animate-shake');
                setTimeout(() => {
                    loginForm.classList.remove('animate-shake');
                }, 500);
            }
        });
        
        // 退出登录
        logoutButton.addEventListener('click', () => {
            isLoggedIn = false;
            recordingForm.classList.add('hidden');
            loginForm.classList.remove('hidden');
            // 重置表单
            personNameInput.value = '';
            recordReasonInput.value = '';
            imageUploadInput.value = '';
            imagePreviewContainer.classList.add('hidden');
            recordSuccess.classList.add('hidden');
        });
        
        // 图片预览
        imageUploadInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    imagePreview.src = event.target.result;
                    imagePreviewContainer.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        });
        
        // 保存记录
        saveRecordButton.addEventListener('click', () => {
            const name = personNameInput.value.trim();
            const reason = recordReasonInput.value.trim();
            const imageSrc = imagePreview.src || '';
            
            if (!name || !reason) {
                alert('请输入姓名和记录原因');
                return;
            }
            
            // 创建新记录
            const newRecord = {
                id: Date.now(),
                name: name,
                reason: reason,
                image: imageSrc,
                timestamp: new Date().toISOString()
            };
            
            // 添加到记录数组
            records.push(newRecord);
            
            // 保存到localStorage
            localStorage.setItem('nameRecords', JSON.stringify(records));
            
            // 显示成功消息
            recordSuccess.classList.remove('hidden');
            setTimeout(() => {
                recordSuccess.classList.add('hidden');
            }, 3000);
            
            // 重置表单
            personNameInput.value = '';
            recordReasonInput.value = '';
            imageUploadInput.value = '';
            imagePreviewContainer.classList.add('hidden');
            
            // 更新最近记录显示
            displayRecentRecords();
        });
        
        // 搜索功能
        searchButton.addEventListener('click', performSearch);
        searchNameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                performSearch();
            }
        });
        
        function performSearch() {
            const searchName = searchNameInput.value.trim().toLowerCase();
            if (!searchName) {
                alert('请输入要查询的姓名');
                return;
            }
            
            // 过滤匹配的记录
            const matchedRecords = records.filter(record => 
                record.name.toLowerCase().includes(searchName)
            );
            
            // 显示搜索结果
            searchResults.classList.remove('hidden');
            
            if (matchedRecords.length === 0) {
                noResults.classList.remove('hidden');
                resultsContainer.innerHTML = '';
            } else {
                noResults.classList.add('hidden');
                resultsContainer.innerHTML = '';
                
                // 按姓名分组统计
                const groupedRecords = {};
                matchedRecords.forEach(record => {
                    if (!groupedRecords[record.name]) {
                        groupedRecords[record.name] = [];
                    }
                    groupedRecords[record.name].push(record);
                });
                
                // 生成结果HTML
                Object.keys(groupedRecords).forEach(name => {
                    const personRecords = groupedRecords[name];
                    const count = personRecords.length;
                    // 使用最新的图片
                    const image = personRecords[personRecords.length - 1].image;
                    
                    const recordItem = document.createElement('div');
                    recordItem.className = 'border-b border-gray-100 pb-4 last:border-0 last:pb-0';
                    
                    recordItem.innerHTML = `
                        <div class="flex flex-col md:flex-row gap-4">
                            ${image ? `
                                <div class="md:w-24 h-24 rounded-lg overflow-hidden flex-shrink-0">
                                    <img src="${image}" alt="${name}" class="w-full h-full object-cover">
                                </div>
                            ` : ''}
                            <div class="flex-1">
                                <div class="flex justify-between items-start">
                                    <h3 class="text-xl font-semibold">${name}</h3>
                                    <span class="bg-blue-100 text-primary text-sm px-2 py-1 rounded-full">
                                        共${count}次记录
                                    </span>
                                </div>
                                
                                <div class="mt-3">
                                    <h4 class="font-medium text-gray-700 mb-2">记录详情：</h4>
                                    <ul class="space-y-2 max-h-60 overflow-y-auto pr-2">
                                        ${personRecords.map(record => `
                                            <li class="flex gap-2">
                                                <span class="text-gray-400 text-sm whitespace-nowrap">${formatDate(record.timestamp)}</span>
                                                <span class="text-gray-600 text-sm">${record.reason}</span>
                                            </li>
                                        `).join('')}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    resultsContainer.appendChild(recordItem);
                });
            }
        }
        
        // 显示最近记录
        function displayRecentRecords() {
            if (records.length === 0) {
                recentRecordsContainer.innerHTML = '<p class="text-gray-500 text-center py-6">暂无记录</p>';
                return;
            }
            
            // 按时间排序，取最近5条
            const recentRecords = [...records]
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                .slice(0, 5);
            
            recentRecordsContainer.innerHTML = '';
            
            recentRecords.forEach(record => {
                const recordItem = document.createElement('div');
                recordItem.className = 'border-b border-gray-100 pb-3 last:border-0 last:pb-0';
                
                recordItem.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <h4 class="font-medium">${record.name}</h4>
                            <p class="text-sm text-gray-600 mt-1 line-clamp-1">${record.reason}</p>
                            <p class="text-xs text-gray-400 mt-1">${formatDate(record.timestamp)}</p>
                        </div>
                        <button onclick="searchByName('${escapeHtml(record.name)}')" class="text-primary text-sm hover:underline">
                            查看详情
                        </button>
                    </div>
                `;
                
                recentRecordsContainer.appendChild(recordItem);
            });
        }
        
        // 辅助函数：格式化日期
        function formatDate(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // 辅助函数：HTML转义
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
        
        // 根据姓名搜索
        function searchByName(name) {
            searchNameInput.value = name;
            performSearch();
            // 滚动到搜索结果
            searchResults.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        // 初始化页面
        document.addEventListener('DOMContentLoaded', () => {
            // 显示欢迎页面
            showSection('welcome');
            
            // 显示最近记录
            displayRecentRecords();
            
            // 移动端菜单切换
            mobileMenuButton.addEventListener('click', toggleMobileMenu);
        });
    </script>
</body>
</html>
    